<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Functional Requirements - Docs</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="status.html">Status</a></li><li class="chapter-item expanded "><a href="functional_requirements.html" class="active"><strong aria-hidden="true">1.</strong> Functional Requirements</a></li><li class="chapter-item expanded "><a href="modularization.html"><strong aria-hidden="true">2.</strong> Modularization</a></li><li class="chapter-item expanded "><a href="performance_goals.html"><strong aria-hidden="true">3.</strong> Performance Goals</a></li><li class="chapter-item expanded "><a href="threat_model.html"><strong aria-hidden="true">4.</strong> Threat Model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="threat_model/methodology.html"><strong aria-hidden="true">4.1.</strong> Methodology</a></li><li class="chapter-item expanded "><a href="threat_model/security_assumptions.html"><strong aria-hidden="true">4.2.</strong> Security Assumptions</a></li><li class="chapter-item expanded "><a href="threat_model/application_assets.html"><strong aria-hidden="true">4.3.</strong> Application Assets</a></li><li class="chapter-item expanded "><a href="threat_model/security_requirements.html"><strong aria-hidden="true">4.4.</strong> Security Requirements</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="threat_model/security_requirements/operators.html"><strong aria-hidden="true">4.4.1.</strong> Operators</a></li><li class="chapter-item expanded "><a href="threat_model/security_requirements/public.html"><strong aria-hidden="true">4.4.2.</strong> Public</a></li><li class="chapter-item expanded "><a href="threat_model/security_requirements/users.html"><strong aria-hidden="true">4.4.3.</strong> Users</a></li><li class="chapter-item expanded "><a href="threat_model/security_requirements/clients.html"><strong aria-hidden="true">4.4.4.</strong> Clients</a></li><li class="chapter-item expanded "><a href="threat_model/security_requirements/federated_homeservers.html"><strong aria-hidden="true">4.4.5.</strong> Federated Homeservers</a></li><li class="chapter-item expanded "><a href="threat_model/security_requirements/federated_users.html"><strong aria-hidden="true">4.4.6.</strong> Federated Users</a></li><li class="chapter-item expanded "><a href="threat_model/security_requirements/federated_clients.html"><strong aria-hidden="true">4.4.7.</strong> Federated Clients</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="cryptographic_primitives.html"><strong aria-hidden="true">5.</strong> Cryptographic Primitives and Schemes</a></li><li class="chapter-item expanded "><a href="authentication_systems.html"><strong aria-hidden="true">6.</strong> Authentication in messaging applications</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="functional-requirements"><a class="header" href="#functional-requirements">Functional Requirements</a></h1>
<p>This section describes the functional requirements of a homeserver. Before we detail the individual requirements, we first introduce the different roles that interact with the system.</p>
<p>Note that while the homeserver should ultimately provide the functionality described, the entity in the given role might have to keep state and perform protocol actions to interact with the homeserver.</p>
<h2 id="roles"><a class="header" href="#roles">Roles</a></h2>
<p>A large part of the infrastructure consists of the homeserver, which is operated by the <em>operator</em>. The homeserver exposes most of its API endpoints to <em>clients</em> of <em>users</em> that are registered with the homeserver. The remaining endpoints of the homeserver's API are accessible to <em>the network</em>, as well as <em>federated homeservers</em>. Individuals that are registered with other homeservers are <em>federated users</em> who run <em>federated clients</em>.</p>
<h3 id="operator"><a class="header" href="#operator">Operator</a></h3>
<p>The entity that operates a homeserver. It is assumed to have control over the domain they configure as the homeserver's <em>home domain</em>.</p>
<h3 id="the-network"><a class="header" href="#the-network">The Network</a></h3>
<p>The network includes all entities that have access to the port exposing the homeserver endpoints.</p>
<h3 id="users"><a class="header" href="#users">Users</a></h3>
<p>Users are individuals that have registered as users with the homeserver and that are associated with a unique and immutable <em>user id</em> scoped by the homeserver's home domain. Each user also has a unique <em>user name</em>. Registered users can have one or more registered clients.</p>
<p>The user is ultimately the entity that other users authenticate before starting a conversation.</p>
<p>In the context of federation, users of a given homeserver will sometimes be called <em>local</em> users as opposed to <em>federated</em> users.</p>
<h3 id="clients"><a class="header" href="#clients">Clients</a></h3>
<p>A client is a piece of software associated with and run by a user. The client holds the key material used to authenticate (and thus the user) to other clients and their users. Each client is associated with a <em>client id</em> that is scoped by its user's ID.</p>
<h3 id="federated-homeservers"><a class="header" href="#federated-homeservers">Federated Homeservers</a></h3>
<p>Other instances of the homeserver that are reachable via the network, where both the local and the federated homeserver have been configured to allow mutual federation. Each is assumed to be configured with its own home domain.</p>
<h3 id="federated-users"><a class="header" href="#federated-users">Federated Users</a></h3>
<p>Individuals that have registered with a federated homeserver in the same way as users have with the local one.</p>
<h3 id="federated-clients"><a class="header" href="#federated-clients">Federated Clients</a></h3>
<p>Federated clients are clients which are run by federated users. They are regular clients that are associated with a federated user instead of a local user.</p>
<h2 id="functional-requirements-for-each-role"><a class="header" href="#functional-requirements-for-each-role">Functional Requirements for each Role</a></h2>
<h3 id="functional-requirements-for-homeserver-operators"><a class="header" href="#functional-requirements-for-homeserver-operators">Functional Requirements for Homeserver Operators</a></h3>
<ul>
<li>Homeserver management: Operators MUST be able to configure the homeserver and manage its users locally.</li>
<li>Homedomain setup: Operators MUST be able to set the home domain of the homeserver during setup.</li>
<li>Federation configuration: Operators MUST be able to configure federation: Either by allowlisting other homeservers by their home domain, or by allowing open federation except for a blocklist of home domains for homeservers with which federation is not desired.</li>
</ul>
<h3 id="functional-requirements-for-the-network"><a class="header" href="#functional-requirements-for-the-network">Functional Requirements for the Network</a></h3>
<ul>
<li>User registration: Entities in the public network MUST be able to register a new user.</li>
</ul>
<h3 id="functional-requirements-for-users"><a class="header" href="#functional-requirements-for-users">Functional Requirements for Users</a></h3>
<p>The distinction between users and their clients is difficult because the user will perform most of their interactions with the homeserver through the client. The following is a list of operations performed through the client, which concern the user as their own entity and might thus also affect all of their clients.</p>
<ul>
<li>Client management: Users MUST be able to manage clients (this includes updates to client key material).</li>
<li>Account reset: Users SHOULD be able to reset the account. Members of groups the user is in MUST be notified of the reset.</li>
<li>User name change: Users MUST be able to change their user name. Members of groups the user is in MUST be notified of the new name.</li>
<li>User discovery: Users MUST be able to discover other users.</li>
<li>Connection establishment: Users MUST be able to initialize a connection with previously discovered users (via a two-user MLS group, implies retrieval of <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-11">KeyPackages</a> of all of the other user's clients).</li>
<li>Connection rejection: Users MUST be able to accept or reject a connection initialized by another (local or federated) user. The sender of the connection request SHOULD be notified of the acceptance or rejection of the request.</li>
<li>Connection management: Users SHOULD be able to block other (local or federated) users s.t. they don't receive messages from that user anymore. Users SHOULD be able to unblock previously blocked users.</li>
<li>Account deletion: Users MUST be able to delete their account. Members of groups the user is in MUST be notified of the deletion.</li>
</ul>
<h3 id="functional-requirements-for-clients"><a class="header" href="#functional-requirements-for-clients">Functional Requirements for Clients</a></h3>
<p>MLS natively provides a number of group management mechanics such as membership management. The homeserver's task is thus to fulfill the role of an MLS <a href="https://www.ietf.org/id/draft-ietf-mls-architecture-08.html#section-4">Delivery Service</a>.</p>
<ul>
<li>Group creation: Clients MUST be able to initialize an MLS group.</li>
<li>Group deletion: Clients MUST be able to delete an MLS group.</li>
<li>Message delivery: Clients MUST be able to asynchronously send <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-7">MLS messages</a> to all members of an MLS group that it is a member of (this implies the &quot;filtering server&quot; role specified by the <a href="https://www.ietf.org/id/draft-ietf-mls-architecture-08.html#section-4.3">&quot;delivery of messages&quot;</a> requirement of the MLS architecture document). If a given group member has provided the homeserver with a notification for this group, the homeserver MUST attach the notification policy to the message when delivering it. If a group member is a federated client, the homeserver MUST forward the message to the federated homeserver for delivery.</li>
<li>Message queuing: The homeserver MUST store messages sent to a client either by itself or forwarded by a federated homeserver while the client is offline.</li>
<li>Message notifications: Clients MAY provide the homeserver with a means to notify them when a new message is queued, as well as a default notification policy. If the client has provided the homeserver with such a means and corresponding policy, the homeserver MUST notify the client according to either the policy attached to the message, or, if none was attached, according to the default policy.</li>
<li>KeyPackage retrieval: Clients MUST be able to retrieve <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-11">KeyPackages</a> for clients of users with a previously established connection (this implies the <a href="https://www.ietf.org/id/draft-ietf-mls-architecture-08.html#name-key-storage">&quot;key storage&quot;</a> requirement). As long as there is more than one KeyPackage, the server MUST delete the KeyPackage after it was provided to a (local or federated) client.</li>
<li>Welcome message delivery: Clients MUST be able to send <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-13.4.3.1">Welcome</a> messages to clients of users with a previously established connection. If the client has provided the homeserver with a means of notification (and default notification policy), the homeserver MUST notify the client according to the default policy.</li>
<li>Message retrieval: Clients MUST be able to fetch messages queued by the homeserver.</li>
<li>Client authentication: Clients MUST be able to verify the authenticity of MLS leaf <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#name-credentials">Credentials</a> of clients with which it shares a group (this implies at least partially fulfilling the <a href="https://www.ietf.org/id/draft-ietf-mls-architecture-08.html#name-authentication-service">Authentication Service</a> role).</li>
<li>KeyPackage publishing: Clients MUST be able to publish <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-11">KeyPackages</a> (this implies the <a href="https://www.ietf.org/id/draft-ietf-mls-architecture-08.html#name-key-retrieval">&quot;key retrieval&quot;</a> requirement). When a client publishes new KeyPackages, the homeserver MUST delete all remaining previously uploaded KeyPackages of that client.</li>
<li>Notification configuration: Clients SHOULD be able to configure notification settings of groups of which it is a member.</li>
</ul>
<h3 id="functional-requirements-for-federated-homeservers"><a class="header" href="#functional-requirements-for-federated-homeservers">Functional Requirements for Federated Homeservers</a></h3>
<ul>
<li>Federated message delivery: Federated homeservers MUST be able to send messages for delivery to one of the homeserver's clients.</li>
</ul>
<h3 id="functional-requirements-for-federated-users"><a class="header" href="#functional-requirements-for-federated-users">Functional Requirements for Federated Users</a></h3>
<p>The functional requirements <em>user discovery</em> and <em>connection establishment</em> for local users also apply for federated users.</p>
<h3 id="functional-requirements-for-federated-clients"><a class="header" href="#functional-requirements-for-federated-clients">Functional Requirements for Federated Clients</a></h3>
<p>The functional requirements <em>message delivery</em>, <em>KeyPackage retrieval</em>, <em>welcome message delivery</em>, <em>client authentication</em> and <em>notification configuration</em> for local clients also apply for federated clients.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="status.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="modularization.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="status.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="modularization.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
