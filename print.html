<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Docs</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="status.html">Status</a></li><li class="chapter-item expanded "><a href="functional_requirements.html"><strong aria-hidden="true">1.</strong> Functional Requirements</a></li><li class="chapter-item expanded "><a href="modularization.html"><strong aria-hidden="true">2.</strong> Modularization</a></li><li class="chapter-item expanded "><a href="performance_goals.html"><strong aria-hidden="true">3.</strong> Performance Goals</a></li><li class="chapter-item expanded "><a href="threat_model.html"><strong aria-hidden="true">4.</strong> Threat Model</a></li><li class="chapter-item expanded "><a href="cryptographic_primitives.html"><strong aria-hidden="true">5.</strong> Cryptographic Primitives and Schemes</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>This book contains design considerations and documentation for an infrastructure that allows clients to exchange messages via the Messaging Layer Security (MLS) protocol.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="open-mls-infrastructure-project-status"><a class="header" href="#open-mls-infrastructure-project-status">Open MLS Infrastructure Project Status</a></h1>
<h2 id="update-0-july-22-2022"><a class="header" href="#update-0-july-22-2022">Update 0, July 22 2022</a></h2>
<p>Today, we publish a <a href="./threat_model.html">threat model</a> for an abstract homeserver that aims fulfills the functional requirements. The threat model also contains privacy and security requirements. This is a first iteration and just like the functional requirements, we expect this to be a living document that grows as we move forward with this project.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="functional-requirements"><a class="header" href="#functional-requirements">Functional Requirements</a></h1>
<p>Before we introduce the architecture and the individual modules, we first define the functional requirements for the homeserver as a whole. We begin with the requirements dictated by the underlying Messaging Layer Security (MLS) protocol. While MLS doesn’t necessarily require a central component like a homeserver, it greatly increases the robustness of the protocol. All references to MLS within this document refer to draft 16 of the MLS specification.</p>
<ul>
<li>Message distribution: Clients MUST be able to have the homeserver distribute <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-7">MLS messages</a> to other members of a group.</li>
<li>Authentication: Clients MUST be able to authenticate other clients. The homeserver MUST provide the baseline in terms of client authentication by providing a cryptographic link between the user's primary identifier (e.g. a username) of a given user and the key material they use to sign their MLS messages.</li>
<li>KeyPackage distribution: Clients MUST be able to upload their own <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-11">KeyPackages</a> to the homeserver and download those of other clients to facilitate asynchronous group additions.</li>
</ul>
<p>Besides these basic functional requirements, a modern messaging infrastructure has to provide a few additional services.</p>
<ul>
<li>User and client management: Users MUST be able to register and add or remove clients afterwards, as well as delete their own user account, along with any of their associated data.</li>
<li>Queuing: Since message distribution should be possible asynchronously, the homeserver MUST provide a mechanism for messages to be queued until their intended recipient comes online to collect them.</li>
<li>Realtime notifications: When a message is queued for a given user, the homeserver MUST try to alert the user in real-time, such that they can retrieve their message. The ability to do so might depend on the user’s client(s).</li>
<li>Group management: Message distribution will require that a certain amount of group-specific information is stored on the homeserver. Users MUST be able to manage that information. Ability to manage the group SHOULD be subject to a member’s role in the group (Admin/Member).</li>
<li>User discovery: Users MUST be able to find other users by their full, primary identifier and obtain KeyPackages for their client(s).</li>
</ul>
<p>Finally, homeservers should be able to federate with one-another. The scope of the federation, i.e. with which set of homeserver a given homeserver federates is up to the individual homeserver operators.</p>
<ul>
<li>Federated user discovery and KeyPackage distribution: Users on a given homeserver MUST be able to find users on other, federated homeservers and obtain KeyPackages for their client(s).</li>
<li>Federated message distribution: Users must be able to send MLS messages to users on a federated homeserver.</li>
</ul>
<p>Besides these basic example, a modern messenger should enable other sophisticated features such as real time voice and video chat. Since the goal of this project is an initial proof of concept, we omit these for now.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modularization-and-architecture-overview"><a class="header" href="#modularization-and-architecture-overview">Modularization and Architecture Overview</a></h1>
<p>The requirements sketched above provide a good distribution of services across modules within the homeserver. Here, we provide a list of modules, as well as the functionality we expect them to provide to users and their clients.</p>
<h2 id="modules"><a class="header" href="#modules">Modules</a></h2>
<ul>
<li>Delivery service:
<ul>
<li>Initial creation of a group and management of the corresponding state (including addition and removal of members)</li>
<li>Message delivery to members of a given group</li>
</ul>
</li>
<li>Authentication service:
<ul>
<li>Registration of new users</li>
<li>Addition and removal of clients of a given user</li>
<li>User discovery</li>
<li>Authentication of users through their clients</li>
</ul>
</li>
<li>Queuing service:
<ul>
<li>Creation of queues for clients</li>
<li>Enqueuing of messages by the delivery service</li>
<li>Dequeuing of messages by the client owning the queue</li>
</ul>
</li>
<li>KeyPackage service:
<ul>
<li>Upload of KeyPackages</li>
<li>Retrieval of KeyPackages for a given client or user</li>
</ul>
</li>
</ul>
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<p>The following shows a simplified interface between client and homeserver. Note, that for some of the security requirements (which we will detail in a later report), we might add one or more additional modules. For example, we will likely add a module that provides DDoS protection.</p>
<p><img src="images/homeserver_interface.png" alt="Simplified interface for client ↔ backend communication." /></p>
<p>Simplified interface for client ↔ backend communication.</p>
<h2 id="federated-architecture"><a class="header" href="#federated-architecture">Federated Architecture</a></h2>
<p>We will later generalize the above architecture to work in a federated setting. The general principle here is that individual clients only ever communicate through their own homeserver, so if a client’s query is w.r.t. another client, user or group that exists on another backend, that query will be forwarded accordingly. The target client/user/group’s homeserver is implicit in the GroupId/UserId/QueueId in question.</p>
<p><img src="images/cross_homeserver_flow.png" alt="Sketch of a message delivery from one client across two homeserver. Alice contacts her Delivery Service, which in turn contacts the Queuing Service of Backend 2. Finally, Bob can retrieve the message from his homeserver by contacting the Queuing Service." /></p>
<p>Sketch of a message delivery from one client across two homeserver. Alice contacts her Delivery Service, which in turn contacts the Queuing Service of Backend 2. Finally, Bob can retrieve the message from his homeserver by contacting the Queuing Service.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="performance-goals"><a class="header" href="#performance-goals">Performance goals</a></h1>
<p>The goal of the homeserver(s) is to facilitate messaging for consumers in general and in particular consumers with resource constrained devices such as smartphones running. Despite the advances in battery capacity, memory and computational performance in modern smartphones, consumers should still be able to communicate with the infrastructure without incurring disproportionate resource consumption. Additionally applications should be able to use the infrastructure without requiring exceptions to the restrictions that platforms running on modern smartphones (Android, iOS) impose on applications such as limited computation time when running in the background.</p>
<p>Similarly, homeserver operators should be able to run their servers without a significant overhead in costs due to computation, memory or persistent storage.</p>
<p>Quantifying performance goals is hard, since the hardware differs significantly across vendors. However, since cryptography is going to make up the largest consumer of computation time, as well as memory and persistent storage, we are going to use asymmetric cryptographic operations (public key encryption, signatures) as unit of measurement for computational overhead and number of keys that need to be stored as unit of measurement for memory and persistent storage overhead. This has the added advantage that we can later estimate the additional overhead in case of adoption of a Post-Quantum secure scheme with significantly larger key sizes.</p>
<h2 id="client-queries"><a class="header" href="#client-queries">Client Queries</a></h2>
<ul>
<li>Network overhead: Clients should be able to perform the most commonly used queries (i.e. send a message to a group or retrieve messages from their queue) with a single round-trip. In particular, it should be possible to request own messages in batch, although the service might limit the size each batch of messages retrieved at a time, leading to additional round trips.</li>
<li>Computational overhead: The estimated computational cost for a given query heavily depends on the type of query. Let n be the number of member in a given group.
<ul>
<li>Simple (application) message to a group: One asymmetric operation for both sender and receiver</li>
<li>Message updating encryption key material: Less than 3log(n) asymmetric operations for the sender and less than log(n)</li>
<li>Message updating authentication key material of adding/removing a group member: Same as updating encryption key material plus &lt;10 asymmetric operations per joining client</li>
<li>Joining a new group: between 5n and 10n asymmetric operations</li>
</ul>
</li>
</ul>
<p>Performance constraints are especially important if the respective operations are potentially performed in the background, i.e. when a user is not currently interacting with the client.</p>
<h2 id="homeserver-processing"><a class="header" href="#homeserver-processing">Homeserver Processing</a></h2>
<ul>
<li>Network overhead: Homeservers should typically respond to one message with one response, although fan-out of a message can result in additional messages sent over the network in a federated setting. Note, that disproportionate amplification of network traffic (i.e. one client request causing a number of server requests) will be mitigated by rate limiting measures such as traditional IP-based rate limiting and schemes such as Privacy Pass.</li>
<li>Computational overhead: With the exception of the group joining cost, the computational cost of the server will be roughly equivalent to that of a client processing a given message.</li>
<li>IO overhead: A query from a client should result in at most one read and one write operation from/to the homeserver’s database, although we expect caching to reduce the number of reads significantly.</li>
</ul>
<h2 id="additional-overhead-due-to-rate-limiting"><a class="header" href="#additional-overhead-due-to-rate-limiting">Additional Overhead due to Rate-Limiting</a></h2>
<p>More sophisticated rate limiting measures, such as the Privacy Pass protocol might create additional overhead, such as an occasional additional round-trip and asymmetric operation to retrieve an access token from the homeserver. We estimate the required frequency of this kind of operation to be at most once per day.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="threat-model"><a class="header" href="#threat-model">Threat model</a></h1>
<p>The subject of this threat analysis is a running homeserver application that serves its client and, potentially, other, federated homeservers. This document currently does not consider threats to the code base of the homeserver the deployment process, or any other supply chain attacks.</p>
<h2 id="requirements-and-objectives"><a class="header" href="#requirements-and-objectives">Requirements and objectives</a></h2>
<p>The goal of this project is to provide an implementation of a homeserver. The homeserver should facilitate the communication between clients encrypted with the Messaging Layer Security (MLS) protocol, both for clients of the homeserver itself, as well as clients of other homeservers that the homeserver federates with.</p>
<aside>
💡 Throughout this document, we will use the terms user and client interchangeably, as users interact with the homeserver through their client. We will distinguish explicitly where necessary.
</aside>
<h3 id="privacy-requirements"><a class="header" href="#privacy-requirements">Privacy requirements</a></h3>
<p>The design of the homeserver has a significant influence on how much metadata it accrues about its users and their interactions.</p>
<p>The homeserver MUST minimize the amount of metadata it requires in general and should only keep it where it is necessary to perform its functional requirements. Where metadata is kept, the homeserver MUST take measures to ensure that it is deleted from memory as soon as possible and encrypted at rest if it needs to be stored.</p>
<p>For functionality, where the homeserver does not explicitly need to know a client’s identity, it MUST enable anonymous access. By anonymous access, we mean that the homeserver MUST NOT be able to link two individual client requests by the content of the request alone.</p>
<p>Where it is required to explicitly authenticate a given client, the homeserver MUST allow the client to authenticate via an ephemeral pseudonym. By pseudonym, we mean a pseudorandomly generated identifier that the client can use to repeatedly authenticate itself towards the homeserver and that is not linked to its actual client identity.</p>
<h3 id="security-requirements"><a class="header" href="#security-requirements">Security requirements</a></h3>
<p>The homeserver needs to implement security measures to protect three main assets: availability of its services, maintaining the privacy requirements detailed above and the veracity of the public authentication key material of its users.</p>
<h4 id="authentication-key-material"><a class="header" href="#authentication-key-material">Authentication key material</a></h4>
<p>While the underlying MLS protocol ensures that messages are end-to-end encrypted, the homeserver is still trusted to facilitate the discovery of other users and the provisioning of users with the public authentication key material of other users they interact with. While in theory, users could exchange public keys manually, or verify the veracity of server-distributed key material out-of-band, this rarely happens in practice. The authentication service part of the homeserver MUST use a verifiable log to allow users to compare their view of the authentication key material distributed by the homeserver.</p>
<h4 id="availability"><a class="header" href="#availability">Availability</a></h4>
<p>The homeserver MUST to ensure that no actor besides the homeserver’s operator can compromise the availability of the homeserver’s services to other, legitimate actors. More concretely, the homeserver MUST take measures to ensure that no actor other than the homeserver’s operator can consume a disproportionate amount of the homeserver’s resources, regardless of the impact on other actors.</p>
<h4 id="metadata-protection"><a class="header" href="#metadata-protection">Metadata protection</a></h4>
<p>The homeserver MUST ensure that the metadata it holds to fulfill its functional requirements are not leaked to other actors that are not explicitly authorized to learn the metadata. For example, clients that are not part of a given group must not learn its membership list.</p>
<h3 id="objectives"><a class="header" href="#objectives">Objectives</a></h3>
<p>Given the functional requirements, as well as the security and privacy requirements above, we can now list a number of objectives that are targets to potential attacks on the homeserver.</p>
<ul>
<li>The metadata of its clients</li>
<li>The veracity of the public authentication key material of the homeserver</li>
<li>The availability of the homeserver’s individual services to its own clients
<ul>
<li>Sending messages and other group operations</li>
<li>Retrieving messages from queues</li>
<li>Managing the own user’s clients</li>
<li>Obtaining public key material of other clients</li>
<li>Uploading and downloading KeyPackages</li>
</ul>
</li>
<li>The availability of its services to clients of federated homeservers
<ul>
<li>Sending messages and other group operations</li>
<li>Obtaining public key material of other clients or the homeserver itself</li>
<li>Downloading KeyPackages</li>
</ul>
</li>
<li>The availability of its services to federated homeservers
<ul>
<li>Fanning out messages to queues of the homeserver’s clients</li>
</ul>
</li>
<li>The availability of its services to everyone with network access
<ul>
<li>Registering a new client</li>
<li>Obtaining the homeserver’s own public key material</li>
</ul>
</li>
</ul>
<h2 id="scope"><a class="header" href="#scope">Scope</a></h2>
<p>The scope of this threat model is the homeserver implementation in general and that of its individual services in particular, its availability, the metadata it stores in memory, as well as the metadata it stores at rest.</p>
<p>For now, we assume that the homeserver is deployed as a monolith, with its individual services communicating within a trust boundary. Other deployment types could require more granular threat models.</p>
<p>To keep it simple, we also don’t consider the supply chain part of the scope and define the threat model only for a running instance of the homeserver.</p>
<h2 id="actors"><a class="header" href="#actors">Actors</a></h2>
<p>The actors that are relevant for this threat model are as follows, each relative to a given homeserver:</p>
<ul>
<li>The individual homeserver services</li>
<li>Operators of the homeserver
<ul>
<li>Those with access to data at rest</li>
<li>Those with access to data in memory</li>
</ul>
</li>
<li>The operator of the network (for now, we don’t distinguish between subsets of the network, e.g. between the homeserver and its clients, or the homeserver and other homeservers)</li>
<li>The clients of the homeserver itself
<ul>
<li>Specifically the members of a given group on the homeserver
<ul>
<li>Admins of that group</li>
<li>Regular Members of that group</li>
</ul>
</li>
</ul>
</li>
<li>Other homeservers that federate with the given homeserver and their operators</li>
<li>Clients of homeservers that federate with the given homeserver</li>
<li>Non-clients, i.e. anyone else communicating with the homeserver</li>
</ul>
<h3 id="trust-boundaries"><a class="header" href="#trust-boundaries">Trust boundaries</a></h3>
<p>Trust boundaries between the individual actors exist in several flavors, each characterized by the nature of the authentication that actors inside the respective trust boundary have to provide to one another.</p>
<ul>
<li>Homeserver operators and their own users</li>
<li>Homeserver operators and operators of federated homeservers</li>
<li>Homeserver operators and users of federated homeservers</li>
</ul>
<h2 id="threats"><a class="header" href="#threats">Threats</a></h2>
<p>We now consider individual threats from the various actors in case they are malicious or compromised. For now, we consider threats that emerge from individual actors with their corresponding capabilities or set of capabilities.</p>
<p>This is a collection of a variety of threats that we will update as we go and as we explore as we design the homeserver specification.</p>
<h3 id="denial-of-service-attacks"><a class="header" href="#denial-of-service-attacks">Denial of service attacks</a></h3>
<p>There are several vectors that can be used to attack the availability of one or more of the homeserver’s services.</p>
<h4 id="attacks-by-adversaries-with-network-access-to-the-homeserver"><a class="header" href="#attacks-by-adversaries-with-network-access-to-the-homeserver">Attacks by adversaries with network access to the homeserver</a></h4>
<p>We assume here that the homeserver requires authentication for all endpoints that are not required to bootstrap entry into one of the trust boundaries. These are, in particular, user registration, and obtaining the homeserver’s public key material (for federation).</p>
<ul>
<li><strong>DoS1:</strong> Opening a large amount of connections to the homeserver: This potentially includes the setup of a TLS connection, as well as any potential attempt of the homeserver to authenticate the sender (explicitly, pseudonymously, or anonymously).</li>
<li><strong>DoS2:</strong> Registering a large number of users: The registration of a user (and the initial client) takes up computational resources (as the homeserver has to sign credentials for the new client) and storage (storing key material of the new user and client).</li>
</ul>
<h4 id="attacks-by-registered-clientsusers"><a class="header" href="#attacks-by-registered-clientsusers">Attacks by registered clients/users</a></h4>
<p>Attacks by registered clients/users can be attacks by existing, malicious clients/users, or as a follow-up of a <strong>DoS2</strong> attack. Note that a successful <strong>DoS2</strong> attack will multiply the impact of each of these attacks.</p>
<ul>
<li><strong>DoS3:</strong> Creating a large amount of (potentially very large) groups or increasing the size of existing groups, thus consuming storage of the homeserver proportional to the number and the size of the group, as well as (potentially) bandwidth for downloads of the group’s public state by new clients. This attack can also be used to flood other users/clients with group invitations.</li>
<li><strong>DoS4:</strong> Sending a large amount of (potentially very large) messages to (potentially very large, see <strong>DoS3</strong>) groups or to a large number of groups, thus consuming storage (for message queuing), computational resources (for message verification and validation) and bandwidth. This attack can also be used to flood other users/clients with messages.</li>
<li><strong>DoS5:</strong> Uploading a large number of KeyPackages, thus consuming storage of the homeserver.</li>
<li><strong>DoS6:</strong> Uploading KeyPackages or creating groups with large extensions, thus consuming storage of the homeserver.</li>
<li><strong>DoS7:</strong> Downloading all KeyPackages of one or more users, thus consuming bandwidth and degrading the security of the owners by forcing other clients to use the KeyPackage of last resort (see <a href="https://www.ietf.org/archive/id/draft-ietf-mls-protocol-16.html#section-16.4">Section 16.4 of the MLS specification</a>).</li>
</ul>
<h4 id="attacks-by-clientsusers-of-federated-homeservers"><a class="header" href="#attacks-by-clientsusers-of-federated-homeservers">Attacks by clients/users of federated homeservers</a></h4>
<p>Here, the attacks <strong>DoS4</strong> and <strong>DoS7</strong> apply in the same way.</p>
<h4 id="attacks-by-non-admin-members-of-a-specific-group"><a class="header" href="#attacks-by-non-admin-members-of-a-specific-group">Attacks by (non-admin) members of a specific group</a></h4>
<p>We assume here that non-admins can still manage their own clients within the group and send regular group messages.</p>
<ul>
<li><strong>DoS8:</strong> Sending an invalid update to the group that the homeserver can recognize as invalid.</li>
<li><strong>DoS9:</strong> Sending an invalid update to the group that the homeserver can’t recognize as invalid.</li>
<li><strong>DoS10:</strong> Sending an invalid update to the group that only a part of the group can recognize as invalid.</li>
</ul>
<p>We consider invalid group updates DoS attacks since they will make the homeserver change the state of the group, forcing other clients to either somehow role the state back (if they recognize the operation as invalid) or re-join the group if the invalid update caused their local group state to diverge from the rest of the group. Since all of these require additional interaction by clients and generally complicate the logic around state-keeping by the homeserver, the potential for invalid updates should be minimized.</p>
<p>The MLS protocol leaves the possibility for an updating group member to encrypt invalid path secrets to individual subtrees, which can only be detected by members in leaves of the affected subtree.</p>
<h4 id="attacks-by-an-admin-of-a-specific-group"><a class="header" href="#attacks-by-an-admin-of-a-specific-group">Attacks by an admin of a specific group</a></h4>
<p>Conversely, admins can perform the same attacks as regular members. We don’t consider abuse of their elevated privileges an attack. This is equivalent to an admin wanting to sabotage a group by simply removing all members, thus effectively closing the group.</p>
<h4 id="attacks-by-the-operator-of-the-homeserver"><a class="header" href="#attacks-by-the-operator-of-the-homeserver">Attacks by the operator of the homeserver</a></h4>
<p>The operator of the homeserver or an adversary that has active control over it can fully control the homeserver’s interactions with individual clients/users. Depending on their knowledge of the client’s/user’s identity relative to its pseudonyms, the attack can be more or less targeted.</p>
<ul>
<li><strong>DoS11:</strong> Denying a specific client access to explicitly authenticated services (e.g. client additions/removals).</li>
<li><strong>DoS12:</strong> Removing all of a specific user’s clients.</li>
<li><strong>DoS13:</strong> Denying a specific user the issuance of unlinkable tokens, thus disallowing them access to all endpoints after they have spent their remaining tokens.</li>
<li><strong>DoS14:</strong> Denying a client with specific pseudonym access to pseudonymously authenticated services (e.g. sending messages in a group, retrieving messages).</li>
<li><strong>DoS15:</strong> Denying a client access to messages. This can affect either all messages, messages from a particular group, or individual messages chosen by the adversary.</li>
</ul>
<h4 id="attacks-by-the-operator-of-a-federated-homeserver"><a class="header" href="#attacks-by-the-operator-of-a-federated-homeserver">Attacks by the operator of a federated homeserver</a></h4>
<p>Operators of federated homeservers have two main capabilities: Fanning out messages to the target homeserver’s queues and being able to register arbitrarily many clients that in turn can interact with the target homeserver.</p>
<ul>
<li><strong>DoS16:</strong> Sending a large number of messages to queues of the homeserver’s clients.</li>
<li><strong>DoS17:</strong> Same as <strong>DoS4</strong> and <strong>DoS7</strong>, except that they are performed by a large number of clients.</li>
</ul>
<h3 id="metadata-exfiltration-attacks"><a class="header" href="#metadata-exfiltration-attacks">Metadata exfiltration attacks</a></h3>
<p>The following are attacks of actors with various capabilities with the goal of obtaining metadata about the clients of the homeserver.</p>
<h4 id="passive-network-access"><a class="header" href="#passive-network-access">Passive network access</a></h4>
<ul>
<li><strong>ME1:</strong> Observing traffic to identify individual clients and their contacts, either through message inspection or message flow pattern analysis.</li>
</ul>
<h4 id="active-network-access"><a class="header" href="#active-network-access">Active network access</a></h4>
<ul>
<li><strong>ME2:</strong> Tamper with traffic to make client/user queries that reveal their identity, either through message inspection or through message flow pattern analysis.</li>
</ul>
<h4 id="database-leak-or-warrant-for-at-rest-data"><a class="header" href="#database-leak-or-warrant-for-at-rest-data">Database leak or warrant for at-rest data</a></h4>
<p>This threat covers cases where an adversary obtains a snapshot of all the homeserver’s at-rest state. This could be through a database leak or through a warrant served to the homeserver’s operator.</p>
<ul>
<li><strong>ME3:</strong> Obtaining a copy of the homeserver’s database and all metadata in it. This could either reveal metadata immediately (lists of group members, queues with messages that have group ids attached), or by analyzing patterns in the data, e.g. by correlating time-stamped data points such as messages in queues or updates to group states.</li>
</ul>
<h4 id="persistent-passive-compromise-of-the-homeserver"><a class="header" href="#persistent-passive-compromise-of-the-homeserver">Persistent, passive compromise of the homeserver</a></h4>
<p>A persistent, passive compromise includes the adversary’s capability to read memory and observe incoming messages. For now, we don’t differentiate between full homeserver compromise and compromise of the individual services.</p>
<ul>
<li><strong>ME4:</strong> Observing the homeserver’s memory and all metadata in it.</li>
<li><strong>ME5:</strong> Observing incoming messages and changes to specific groups in an effort to link individual users/clients to one or more anonymous or pseudonymous interactions.</li>
</ul>
<h4 id="malicious-homeserver-operator-or-active-persistent-compromise"><a class="header" href="#malicious-homeserver-operator-or-active-persistent-compromise">Malicious homeserver operator or active, persistent compromise</a></h4>
<p>An adversary with active, persistent access has the same capabilities as an adversary with passive persistent access, along with the ability to make arbitrary changes to the homeserver’s memory and at-rest state including any key material.</p>
<ul>
<li><strong>ME6:</strong> Impersonating the homeserver to one of its clients in an effort to link an otherwise anonymous or pseudonymous interaction with the client’s actual identity.</li>
</ul>
<h3 id="meddler-in-the-middle-attacks"><a class="header" href="#meddler-in-the-middle-attacks">Meddler-in-the-middle attacks</a></h3>
<p>While encrypted MLS messages are generally authenticated by the sender’s signature, the homeserver plays a role in distributing the public signature keys of clients and their KeyPackages.</p>
<h4 id="active-network-access-1"><a class="header" href="#active-network-access-1">Active network access</a></h4>
<ul>
<li><strong>MitM1:</strong> Impersonate the homeserver towards a client and provide that client with bogus signature keys that allow the adversary to impersonate other clients towards the target client.</li>
</ul>
<h4 id="malicious-homeserver-operator-or-active-persistent-compromise-1"><a class="header" href="#malicious-homeserver-operator-or-active-persistent-compromise-1">Malicious homeserver operator or active, persistent compromise</a></h4>
<ul>
<li><strong>MitM2:</strong> Provide a client with bogus key material that allows the adversary to impersonate other clients towards the target client, potentially doing the same in the other direction as well for a full meddler-in-the-middle attack.</li>
<li><strong>MitM3:</strong> Create one or more fake clients for a given user and try to have the client’s contacts add them to the groups that the user’s other clients are in.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cryptographic-primitives-and-schemes"><a class="header" href="#cryptographic-primitives-and-schemes">Cryptographic primitives and schemes</a></h1>
<p>To fulfill the functional and performance requirements, as well as those for security and privacy, the homeserver will need to employ a number of cryptographic primitives, e.g. signature, authenticated encryption, etc. This chapter discusses the primitives required, as well as the choice of schemes that are used for the initial specification. As customary in other protocol specifications the set of schemes used by a homeserver is called the homeserver's ciphersuite.</p>
<h2 id="federation-and-cryptographic-agility"><a class="header" href="#federation-and-cryptographic-agility">Federation and cryptographic agility</a></h2>
<p>Each homeserver operator will have its own requirements with regard to the ciphersuite that they want to use. This could be, for example, due to the requirement for the primitives to be certified in some way, or to meet a specific level of security for organizational policy reasons.</p>
<p>The underlying Messaging Layer Security (MLS) supports agility for a number of reasons and homeservers should, too.</p>
<p>For the initial homeserver specification, however, only one ciphersuite will be supported, even though the design will accommodate the requirement for homeservers to advertise their ciphersuite support.</p>
<h2 id="list-of-cryptographic-primitives-and-schemes"><a class="header" href="#list-of-cryptographic-primitives-and-schemes">List of cryptographic primitives and schemes</a></h2>
<p>For now, the homeserver is anticipated to require mostly basic symmetric and asymmetric primitives to fulfill its functional requirements. This is with the exception of an unlinkable token scheme to enable rate-limiting while allowing clients to access the homeservers services anonymously.</p>
<p>Along with the list of primitives, the list also includes a concrete scheme for each primitive that will be used in the initial specification.</p>
<p>In addition to the scheme's fitness to facilitate the listed requirements of the homeserver (functional, security, privacy, performance), an implementation of each scheme has to be available and fulfill the following criteria:</p>
<ul>
<li>Open source with an OSI-recognized license</li>
<li>ideally implemented in Rust</li>
<li>actively and well maintained</li>
</ul>
<p>The RustCrypto suite of cryptographic implementations provides well-maintained Rust implementations of a large variety of cryptographic primitives and schemes. While they are generally not as highly optimized for performance as other available implementations, they provide a good baseline that is sufficient for a PoC homeserver implementation. In the future, we hope to upgrade any implementations we decide on for the PoC with similarly well performing ones that have formally verified properties such as functional correctness and secret-independent execution,</p>
<p>When it comes to the concrete choice of primitives and schemes, an easy choice for the initial specification is the suite of schemes in the “mandatory-to-implement” (MTI) ciphersuite of MLS, as it represents a compromise between security and good performance on a variety of devices. In particular, the primitives and schemes are</p>
<ul>
<li>Signatures: Ed25519</li>
<li>Hash function: SHA256</li>
<li>AEAD scheme: AES128-GCM</li>
<li>KEM: DHKEMX25519</li>
</ul>
<p>Additional recommendations for primitives that might be used in the homeserver specification are</p>
<ul>
<li>MAC: HMAC-SHA256</li>
<li>KDF: HKDF-SHA256</li>
</ul>
<p>While these are the schemes that should make up the first ciphersuite of the homeserver, the specification should remain modular, such that multiple schemes can be supported and different versions of the homeserver protocols can introduce or deprecate individual ciphersuites.</p>
<p>All schemes above have been well-tested in a variety of modern, cryptographic protocols (e.g. Signal, TLS). The only choice that might not be immediately obvious is AES128-GCM as AEAD scheme, since in many cases, Chacha20-Poly1905 is frequently used as a more efficient scheme on devices that don’t have hardware support for AES, most of those with ARM processors. However, with the most recent generations of ARM processors supporting AES instructions, AES128-GCM is a good choice for a first ciphersuite, given that support for multiple ciphersuites is planned for the future.</p>
<h2 id="unlinkable-tokens"><a class="header" href="#unlinkable-tokens">Unlinkable tokens</a></h2>
<p>Should unlinkable tokens be used to facilitate a metadata friendly rate-limiting mechanism, their performance is essentially to not ultimately represent a denial of service vulnerability themselves.</p>
<p>Since the Privacy Pass protocol is the only well-known unlinkable token scheme that has seen extensive real-world use and analysis, it is recommended as the protocol of choice for metadata-friendly rate-limiting. Besides its use in practice, it is also on the finishing stretch of the IETF standardization process. Privacy Pass defines a number of token types, each backed by another cryptographic scheme. Performance tests have revealed, however, that all schemes suggested in the draft specification are prohibitively expensive in terms of computational overhead in the various protocol operations. To mitigate this shortcoming, the authors of this document have proposed a new batched token type based on the <a href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-ristretto255-decaf448/">Ristretto255</a> group (also in the process of IETF standardization), which has significantly improved performance over the schemes used by existing token types. These improved results come at a slight security cost, which can be mitigated by a conservative key rotation policy.</p>
<p>The authors have already performed initial performance tests justifying the effort and published <a href="https://raphaelrobert.github.io/privacypass-batched-tokens/draft-robert-privacypass-batched-tokens.html">a document</a> defining the new token type, as well detailing the security recommendations for consideration by the Privacy Pass working group at the IETF.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
